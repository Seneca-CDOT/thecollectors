<!doctype html>
<html>
  <head>
	<title> The Collectors </title>
	<meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="style/style.css">

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>

    <script type="text/javascript" src="minim.js"></script>
    <script type="text/javascript" src="syntaxHighlight.js"></script>
    <script type="text/javascript" src="XMLWriter-1.0.0-min.js"></script>
    <script type="text/javascript" src="processing.js"></script>
    <script type="text/javascript" src="processing-lazyload.js"></script>
    <script type="text/javascript" src="canvasFocus.js"></script>

    <!--Custom utility scripts and global variables-->
    <script type="text/javascript" src="CanvasOverlay.js"></script>
    <script type="text/javascript" src="Utilities.js"></script>
    <script type="text/javascript" src="gameValues.js"></script>

    <!--Custom JavaScript object definitions. Consolidate into one file at the end-->
    <script type="text/javascript" src="Fraction.js"></script>
    <script type="text/javascript" src="Vertex.js"></script>
    <script type="text/javascript" src="Node.js"></script>
    <script type="text/javascript" src="Structure.js"></script>
    <script type="text/javascript" src="Graph.js"></script>
    <script type="text/javascript" src="Map.js"></script>
    <script type="text/javascript" src="MapGenerator.js"></script>
    
    <script src="locale/text.jsonp"></script>
    <script type="text/javascript">
    var fractionCT;
	try {
	  var language = window.navigator.userLanguage || window.navigator.language;
	  //Load the tutorial text from the json file
	  var pageText = JSON.parse(language);
	} catch(err) {
	  var pageText = JSON.parse(en_us);
	}
    </script>

	<style>
	  
	</style>
  </head>
  <body>
  <div id="gameWrap" style="position:absolute;height:644px;">
    <!-- Begin top bar -->
    <div id="topBar">
      <div id="cashImg">
          <img src="./assets/items/money.svg" alt="Money Bag" width="40px" height="40px" />
      </div>
      <div id="cashText" class="labelBox">
          <p id="cashElement" style="font-size:28px;margin:5px;">
          </p>
      </div>
      <div id="parcelImg">
          <img src="./assets/items/parcel.svg" alt="Parcel" width="40px" height="40px" />
      </div>
      <div id="parcelText" class="labelBox">
          <p id="parcelElement" style="font-size:28px;margin:5px;">
          </p>
      </div>
      <button id="newMapButton" style="position:absolute;left:350px;top:10px;" onclick="sketch.newMap()">New Map</button>
      <button id="resetButton" style="position:absolute;left:550px;top:10px;" onclick="sketch.resetMap()">Reset</button>
    </div>
    <!-- End top bar -->
    <!-- Begin tooltips -->
    <div id="cashTooltip" class="tooltip"> </div>
    <div id="parcelTooltip" class="tooltip"> </div>
    <div id="newMapTooltip" class="tooltip"> </div>
    <div id="resetTooltip" class="tooltip"> </div>
    <div id="fuelTooltip" class="tooltip"></div>
    <!-- End tooltips -->
    <canvas onmouseenter="$('canvas').focus()" data-processing-sources="codebase.pde assetPreloader.pde game.pde"></canvas>
    <div id="menuDiv" style="display:none;position:fixed;top:650px;left:0px;">
        <button id="campaignButton"></button><br />
        <button id="quickPlayButton"></button><br />
        <button id="optionsButton"></button>
    </div>
    <div id="difficultyDiv" style="display:none;position:fixed;top:100px;left:250px;">
        <button id="easyButton"></button><br />
        <button id="mediumButton"></button><br />
        <button id="hardButton"></button><br />
    </div>
    <script type="text/javascript" >
	document.getElementById("campaignButton").innerHTML = pageText.campaignButton;
	document.getElementById("quickPlayButton").innerHTML = pageText.quickPlayButton;
	document.getElementById("optionsButton").innerHTML = pageText.optionsButton;
	document.getElementById("easyButton").innerHTML = pageText.easyButton;
	document.getElementById("mediumButton").innerHTML = pageText.mediumButton;
	document.getElementById("hardButton").innerHTML = pageText.hardButton;
    </script>
    <div id="fractionWrap">
      <div id="fractionBonusImg" class="hidden inCanvas" style="position:absolute;left:120px;top:44px;">
        <img src="./assets/items/solve_img.svg" alt="Solve for Bonus!" class="inCanvas" width="700px" height="400px" />
      </div>
      <div id="fractionBoxDiv" class="addBox fractionBox hidden">
        <div id="fractionTextDiv" style="position:relative;">
        </div>
      </div>
    </div>
    <div id="tutorialTextDiv" class="textBox hidden inCanvas" style="position:fixed;left:200px;top:500px;width:500px;height:110px;">
        <p id="tutorialTextElement">
        </p>
    </div>

    <!-- Begin fuel gauge -->
    <div id="fuelWrap">
      <div id="fuelText" class="fuelBox visible inCanvas">
          <p id="fuelElement2" class="center">
          </p>
      </div>
  
      <div id="fuelGauge" class="inCanvas">
          <img src="assets/items/fuel_gauge.svg" alt="Fuel Gauge" width="192px" height="192px" />
      </div>
      <div id="fuelNeedle" class="inCanvas">
          <img src="assets/items/fuel_tick.svg" alt="Fuel Needle" width="48px" height="400px" />
      </div>
    </div>
    <!-- End fuel gauge -->

    <script type="text/javascript">
	var tutorialText = pageText.tutorial;
	var tutorialIndex = 1;
    var bonusTracker = {};
        document.getElementById("tutorialTextElement").innerHTML = tutorialText[tutorialIndex];

        // Event listener for the <p> element containing tutorial instructions.
        document.getElementById("tutorialTextDiv").addEventListener("click", function(event) {
          advanceTutorial();
        }, false);
        function advanceTutorial() {
          if (tutorialIndex < tutorialText.length - 1) {
            document.getElementById("tutorialTextElement").innerHTML = tutorialText[++tutorialIndex];
          }
        }
    </script>

    <script type="text/javascript">

      var gameMode = null;
      var canvasHasFocus = false;
      
      document.addEventListener("DOMMouseScroll", function(e) {
        if (canvasHasFocus) {
          e.preventDefault();
        }
      }, false);
      // Event listener for the div containing the main menu buttons
      document.getElementById("menuDiv").addEventListener("click", function(event) {
        switch (event.target.id) {
          case "campaignButton":
            buttonClick(1);
            break;
          case "quickPlayButton":
            buttonClick(2);
            break;
          case "optionsButton":
            buttonClick(3);
            break;
        }
      }, false);
      // Event listener for the div containing the difficulty menu buttons
      document.getElementById("difficultyDiv").addEventListener("click", function(event) {
        switch (event.target.id) {
          case "easyButton":
            buttonClick(4);
            break;
          case "mediumButton":
            buttonClick(5);
            break;
          case "hardButton":
            buttonClick(6);
            break;
        }
      }, false);

      function buttonClick(buttonVal) {
        switch (buttonVal) {
          case 1:
            menuDiv.style.display = "none";
            difficultyDiv.style.display = "block";
            gameMode = "Campaign";
            break;
          case 2:
            menuDiv.style.display = "none";
            difficultyDiv.style.display = "block";
            gameMode = "Quick Play";
            break;
          case 3:
            player.driveToDestination();
            break;
          case 4:
            difficultyDiv.style.display = "none";
            var sketch = Processing.instances[0];
            console.log(sketch);
            sketch.loadDifficulty(1, gameMode);
            break;
          case 5:
            difficultyDiv.style.display = "none";
            sketch.loadDifficulty(2, gameMode);
            break;
          case 6:
            difficultyDiv.style.display = "none";
            sketch.loadDifficulty(3, gameMode);
            break;
          default:
            alert("Invalid button value!");
            break;
        }
      }

      var numeratorArray = [];
      var inputRegEx = new RegExp("^[0-9]+$");
      var bonusFlag = false, showFractionBox = false;
      var numTest = false, denomTest = false;
      function checkFractionSum() {
          var sum = 0;
          var playerNumerator = document.getElementById("fracSumNum");

          if (numTest && denomTest) {
              for (var i = numeratorArray.length; i--;) {
                  sum += numeratorArray[i];
              }
              numeratorArray.length = 0;
              if (bonusTracker.initialBonusIndex > -1 && parseInt(playerNumerator.value) === sum) {
                  bonusFlag = true;
                  fractionBox.classList.remove("visible");
                  fractionBox.classList.add("hidden");
                  fractionImg.classList.remove("visible");
                  fractionImg.classList.add("hidden");
                  console.log("Bonus applied");
              } else {
                  fractionBox.classList.remove("visible");
                  fractionBox.classList.add("hidden");
                  fractionImg.classList.remove("visible");
                  fractionImg.classList.add("hidden");
                  console.log("Incorrect answer.");
              }
              player.driveToDestination();
          } else {
               //document.getElementById("fractionSum").parentNode.style.backgroundColor = "red";
          }
      }
      function testInput(element) {
          var testResult = inputRegEx.test(element.value);
          if (testResult) {
              element.parentNode.style.backgroundColor = "black";
              switch (element.name) {
                  case "numerator":
                      numTest = true;
                      break;
                  case "denominator":
                      denomTest = true;
                      break;
              }
          } else {
              element.parentNode.style.backgroundColor = "red";
              switch (element.name) {
                  case "numerator":
                      numTest = false;
                      break;
                  case "denominator":
                      denomTest = false;
                      break;
              }
          }
      }
    </script>
  </div>
  </body>  
</html>
